# 2gis-calm-map

Приложение (MVP) для людей из аутистического спектра и чувствительных пользователей. Цель — помочь подобрать пространства (организации), которые максимально комфортны по ряду сенсорных и поведенческих параметров (освещение, запах, шум / плотность людей, интуитивность навигации, тактильность, спокойствие и т.д.).

## Основная идея
Пользователи оставляют оценки и комментарии по набору параметров. По мере накопления отзывов система считает агрегаты (средние значения) для каждой организации. Пользователь (или набор пользовательских предпочтений) может указать важные для него параметры — мы фильтруем и ранжируем организации по средним (арифметическим) по этим параметрам.

## Ссылки (действующие инстансы)
- Swagger (документация API): http://81.29.146.35:8080/swagger/index.html#/
- Фронтенд (статический): http://81.29.146.35:8000/

## Быстрый старт
### 1. Backend (API)
Требуется Docker и Docker Compose.

```bash
cd api
# первый запуск / пересборка образов
docker compose up --build
# или без пересборки (если уже собраны)
# docker compose up
```
По умолчанию сервер слушает порт `:8080` (см. `cmd/main.go`). После запуска документация будет доступна по адресу, указанному выше.

### 2. Frontend (простой статический)
Фронт — статический набор файлов (`index.html`, JS, CSS). Для локального быстрого запуска достаточно встроенного HTTP-сервера Python:

```bash
cd front
python3 -m http.server 8000
```
После этого откройте: http://localhost:8000/

(На продакшене можно вынести в любой CDN / nginx static hosting.)

## Принцип работы (кратко)
1. Пользователь регистрируется / логинится (JWT).
2. Роли: `user`, `owner`, `admin`. 
   - `owner` / `admin` могут создавать организации. 
   - `admin` может иметь несколько организаций (нет лимита), у обычного владельца логика приложения ограничивает одну.
3. Каждая организация хранит агрегированные параметры (таблица `organization_params`). При добавлении нового отзыва по организации:
   - Считаются суммы и количества для каждого параметра.
   - Пересчитывается среднее: `avg = sum / count`.
4. Когда пользователь запрашивает подбор / средние по типу организации — выдаётся среднее по нужным параметрам, при необходимости фильтрация по заданным пользователем критериям.
5. Изображения (карта / основная картинка) можно загрузить для организации: последние загруженные пути хранятся в полях `map_path` и `picture_path`.

## Структура репозитория
```
api/        # Go (Gin, Gorm, Swagger)
front/      # Статический фронт (HTML/CSS/JS)
mobile/     # (пока пусто / задел под мобильный клиент)
```

Ключевые директории backend:
- `internal/handler` — HTTP-обработчики
- `internal/service` — бизнес-логика (тонкая прослойка)
- `internal/repository` — доступ к БД (Gorm)
- `internal/model` — модели данных
- `internal/middleware` — JWT и прочие мидлвары
- `cmd/main.go` — точка входа
- `config/` — конфигурация/DSN

## Авторизация / Безопасность
- JWT в заголовке `Authorization: Bearer <token>`
- Swagger содержит схему `BearerAuth`.
- CORS сейчас максимально разрешительный (для MVP) — стоит ужесточить в продакшене.

## Основные сущности
- User (роль, email, пароль (хэш))
- Organization (адрес, тип, координаты, изображения)
- OrganizationParams (агрегаты по параметрам восприятия)
- OrganizationComment (индивидуальные оценки + текстовые комментарии)

## Пример использования API (в общих чертах)
1. `POST /register` → создать пользователя
2. `POST /login` → получить JWT
3. `POST /organization` → создать организацию (owner/admin)
4. `POST /organization/comment` → добавить отзыв (увеличивает агрегаты)
5. `POST /organization/params/average` / другие endpoints → получить усреднённые значения
6. `GET /organization/{id}/image/{kind}` → получить изображение

Полный список см. в Swagger.

## Персонализация рекомендаций
Параметры, которые указал пользователь (например, важны тишина и освещение), используются для:
- фильтрации организаций у которых есть достаточное количество оценок по этим параметрам;
- сортировки по среднему значению выбранных параметров.

## Идеи для Roadmap
- Весовые коэффициенты параметров (не только простое среднее арифметическое)
- История изображений / галерея
- Очистка старых файлов при загрузке новых
- Нормализация оценок / доверительные интервалы при малом количестве отзывов
- Рекомендательная модель с ML (учёт предпочтений конкретного пользователя)

## Разработка
Локально можно запускать без Docker (при наличии PostgreSQL) — указав DSN в конфиге. Однако Docker Compose упрощает старт.

## Лицензия / Использование
(Добавьте лицензию при необходимости.)

---
Если нужно расширить README (на английском, добавить диаграммы или примеры запросов) — дайте знать.
